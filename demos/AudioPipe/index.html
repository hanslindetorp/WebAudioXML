<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AudioPipe - Gesture Controlled Musical Instrument</title>
    <link rel="stylesheet" type="text/css" href="style/style.css">
    <link rel="stylesheet" type="text/css" href="style/codemirror.css">

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.6/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.3/hands.js" crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="script/XML.js"></script>
    <script type="text/javascript" src="script/lzw_encoder.js"></script>
    <script type="text/javascript" src="script/codemirror.js"></script>
    <script type="text/javascript" src="script/max.size.js"></script>
  </head>

  <body>
    <main class="max-size">
      <section id="play">
        <video class="input_video"></video>
        <canvas class="output_canvas" width="1000" height="567.5"></canvas>
        <waxml-xy-area background-color="rgba(0,0,0,0)" grid-color="rgba(255,255,255,0.4)" columns="8" rows="8"></waxml-xy-area>
      </section>
      
      <section id="edit">
        <input id="instrument-name" value="" placeholder="Intrument Name" />
        <input id="author-name" value="" placeholder="Your Name" />
        <input id="demo-URL" placeholder="URL to demo video" />
        <textarea id="xml-edit"></textarea>
      </section>

      <section id="share">
        <textarea id="shareURL"></textarea>
      </section>

      <section id="help">
        <p>AudioPipe is an implementation of <a href="https://google.github.io/mediapipe/">MediaPipe</a> for 
        <a href="https://github.com/hanslindetorp/WebAudioXML">WebAudioXML</a>. I was inspired by the great idea from 
        <a href="https://github.com/monlim/Handmate-MIDI">Handmate-MIDI</a> to control
        audio data with the fantastic MediaPipe library. AudioPipe is an online, fully programmable,
      gesture controlled musical instrument. You can play with the presets or edit the code and make your own sound
      synthesis and mappings. Please read the documentation for WebAudioXML to take advantage of all the possibilities.
      </p>
      <p>The image below indicates the 21 available points for each hand. In WebAudioXML all those variables can be 
        mapped to any audio parameter using the &lt;var&gt;-element. Please not that all variable names shall be prefixed 
        with a dollar sign. The naming convention for the variables follow the 
        following scheme:
      </p>
      <div>
        <h3>Position on the axis (0 - 1) for each point on each hand:</h3>
        <ul>
          <li>hand_l0x</li>
          <li>hand_l0y</li>
          <li>hand_l1x</li>
          <li>etc...to hand_l21y</li>
          <li>hand_r0x</li>
          <li>hand_r0y</li>
          <li>hand_r1x</li>
          <li>etc...to hand_r21y</li>
        </ul>
        <code>
          Example:<br />
          &lt;var name="f" value="$hand_r8y" mapin="0,1" mapout="100,1000"&gt;&lt;/var&gt;<br />
          &lt;OscillatorNode frequency="$f"&gt;&lt;/OscillatorNode&gt;<br />
        </code>

        <h3>Distance (0 - 1) between each point and all other points</h3>
        <ul>
          <li>hand_r4tor8 (distance between the pointing finger and the thumb on the right hand)</li>
          <li>hand_l8tor8 (distance between the two pointing fingers)</li>
        </ul>
        <code>
          Example:<br />
          &lt;var name="f" value="$hand_r8tor4" mapin="0,1" mapout="100,1000"&gt;&lt;/var&gt;<br />
          &lt;OscillatorNode frequency="$f"&gt;&lt;/OscillatorNode&gt;<br />
        </code>

        <h3>Events</h3>
        <p>Events can trigger Envelopes and AudioFiles using trig="&#91eventName&#93" and/or 
          release="&#91eventName&#93". Please note event names are NOT prefixed with dollar sign.</p>
        <ul>
          <li>trig=&quot;hand_r4tor8&quot; (right hand pointing finger and thumb are touching each other)</li>
          <li>release=&quot;hand_r4tor8&quot; (right hand pointing finger and thumb are releasing each other)</li>
        </ul>
        <code>
          Example:<br />
          &lt;OscillatorNode frequency="440"&gt;&lt;/OscillatorNode&gt;<br />
          &lt;GainNode&gt;&lt;gain&gt;</br>
            &lt;Envelope start=&quot;hand_r4tor4&quot; max=&quot;1&quot; ADSR=&quot;10,100,20,50&quot;&gt&lt;/Envelope&gt;</br>
          &lt;/gain&gt;&lt;/GainNode&gt;<br />
        </code><br />
        <img src="images/hand.png" />
      </div>

      <p>AudioPipe is part of a reasearch project at the <a href="https://www.kmh.se/">Royal College 
        of Music</a> and <a href="https://www.kth.se/">Royal Institute of Technology</a> in Stockholm by 
        Hans Lindetorp. Please follow my blog at <a href="https://hans.arapoviclindetorp.se/">hans.arapoviclindetorp.se/</a></p>
      </section>

      <navigation>
        <a id="playBtn" href="#play">Play</a>
        <a id="editBtn" href="#edit">Edit</a>
        <a id="shareBtn" href="#share">Share</a>
        <a id="helpBtn" href="#help">Help</a>
        <h1>AudioPipe - Gesture Controlled Musical Instrument</h1>
      </navigation>
      
    </main>

    <script src="script/WebAudioXML.js"></script>
    <script src="script/imusic_091.js" data-music-structure="imusic.xml"></script>
    <script type="text/javascript" src="script/script.js"></script>
  </body>
</html>
